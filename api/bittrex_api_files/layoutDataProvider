$(function(){"use strict";function n(n){function k(){u()&&c&&(!n||n.isAuthenticated)&&(r&&c&&i.server.queryOrderState(r).done(function(n){t("server.queryOrderState");t(n);n&&s("data-query-orders",n)}),ot())}function ot(){if(u()&&c){var t="/Api/v2.0/auth/orders/GetOrderHistory",i={};(!n||n.isAuthenticated)&&(n&&n.version&&n.version.needsUpdate||(r&&(t="/Api/v2.0/auth/market/GetOrderHistory",i.MarketName=r),jQuery.ajax({url:t,type:"POST",contentType:"application/x-www-form-urlencoded",dataType:"json",data:i,success:function(n){n.success&&s("data-query-closedOrders",n.result)},error:function(){console.log("Error loading order history ...")}})))}}function st(){u()&&it&&i.server.queryBalanceState().done(function(n){t("server.queryBalanceState");t(n);n&&s("data-query-balances",n)})}function d(){u()&&(a||(a=!0,i.server.queryExchangeState(r).done(function(n){t("server.queryExchangeState().done()");t(n);n&&b&&s("data-query-exchange-"+r,n);a=!1})))}function ht(){n&&n.version&&n.version.needsUpdate||jQuery.ajax({url:"/api/v2.0/pub/Markets/GetMarketSummaries",dataType:"json",cache:!0,success:function(n){n.success?s("data-query-summaries",n.result):console.log(n.message)},error:function(){console.log("Error loading market summaries ...")}})}function o(n,t){$("#event-store").trigger({type:n,serviceData:t})}function s(n,t){$("#event-store").trigger({type:n,serviceData:t})}function ct(){return _.debounce(k,et),!1}function lt(){return d(),!1}var h=n&&n.isAuthenticated,r=n.market&&n.market.marketName?n.market.marketName:null,y=n.market&&n.market.marketName&&n.market.fetchExchange,c=n.fetchOrders,it=n.fetchBalances,p=n.fetchFlood,w=n.fetchSummary,u=ko.observable(!1),f=ko.observable("Disconnected"),i=$.connection.coreHub,l=window.location.href;l.indexOf("beta.bittrex.com")>-1?$.connection.hub.url="https://socket-beta.bittrex.com/signalr":l.indexOf("stage.bittrex.com")>-1?$.connection.hub.url="https://socket-stage.bittrex.com/signalr":l.indexOf("bittrex.com")>-1&&($.connection.hub.url="https://socket.bittrex.com/signalr");var b=!0,rt=!1,ut=!1,ft=!1,et=5e3,a=!1,e=function(){ut&&(console.log("hub.client"),console.log(i))},t=function(n){ft&&console.log(n)};i.client.updateOrderState=function(n){e();t("client.updateOrderState");t(n);n&&o("data-update-orders",n)};i.client.updateSummaryState=function(n){e();t("client.updateSummaryState");t(n);n&&n.Deltas&&o("data-update-summaries",n)};i.client.updateBalanceState=function(n){e();t("client.balanceStateDelta");t(n);n&&o("data-update-balances",n)};i.client.updateExchangeState=function(n){e();t("client.updateExchangeState");t(n);n&&b&&o("data-update-exchange-"+r,n)};i.client.updateFloodState=function(n){e();t("client.updateFloodState");t(n);n&&rt&&o("data-update-flood",n)};$("#event-store").on("request-query-orders",ct);$("#event-store").on("request-query-exchange-"+r,lt);var g=function g(){console.log("socketDataProvider.subscribeUser (start) ");h&&i.server.subscribeToUserDeltas().done(function(n){console.log("server.subscribeToUserDeltas (done)");n?(k(),st()):h=!1}).fail(function(){console.log("socketDataProvider.subscribeToUserDeltas (failed): "+r);$.connection.hub.lastError&&console.log("socketDataProvider.subscribeToUserDeltas (failed): "+$.connection.hub.lastError.message);setTimeout(function(){g()},5e3)})},v=function v(){console.log("socketDataProvider.subscribeMarket (start): "+r);r&&y&&i.server.subscribeToExchangeDeltas(r).done(function(n){console.log("server.subscribeToExchangeDeltas (done) ");n?d():v()}).fail(function(){console.log("socketDataProvider.subscribeToExchangeDeltas (failed): "+r);$.connection.hub.lastError&&console.log("socketDataProvider.subscribeToExchangeDeltas (failed): "+$.connection.hub.lastError.message);v()})},nt=function nt(){console.log("socketDataProvider.subscribeFlood (start) ");p&&i.server.subscribeToFloodDeltas().done(function(){console.log("server.subscribeToFloodDeltas (done)")}).fail(function(){console.log("socketDataProvider.subscribeToFloodDeltas (failed) ");$.connection.hub.lastError&&console.log("socketDataProvider.subscribeToFloodDeltas (failed): "+$.connection.hub.lastError.message);nt()})},at=function(){console.log("socketDataProvider.subscribeSummary (start) ");w&&i.server.subscribeToSummaryDeltas().done(function(){console.log("server.subscribeToSummaryDeltas (done) ")}).fail(function(){console.log("socketDataProvider.subscribeToSummaryDeltas (failed) ");$.connection.hub.lastError&&console.log("socketDataProvider.subscribeToSummaryDeltas (failed): "+$.connection.hub.lastError.message)})},tt=function(){console.log("websocket ready");f("Connected");$("#event-store").trigger({type:"socket-start"});h&&g();y&&v();p&&nt();w&&at();ht();u(!0)};$.connection.hub.start().done(tt);i.client.stopClient=function(){$.connection.hub.stop()};i.client.refresh=function(){market.server.refresh()};$.connection.hub.connectionSlow(function(){console.log("websocket slow");f("Slow");$("#event-store").trigger({type:"socket-slow"})});$.connection.hub.reconnecting(function(){console.log("websocket reconnecting");f("Reconnecting");$("#event-store").trigger({type:"socket-reconnecting"})});$.connection.hub.reconnected(function(){console.log("websocket reconnected");f("Connected");$("#event-store").trigger({type:"socket-connected"})});$.connection.hub.disconnected(function(){console.log("websocket disconnected");f("Disconnected");$("#event-store").trigger({type:"socket-disconnected"});u(!1);setTimeout(function(){$.connection.hub.start().done(tt);console.log("reconnect websockets")},5e3)})}n(bittrex)});$(function(){"use strict";function n(n){function i(){if(bittrex&&bittrex.version&&bittrex.version.needsUpdate){f();return}jQuery.ajax({url:"/Api/v2.0/pub/currencies/GetBTCPrice",dataType:"json",cache:!0,success:function(n){n.success&&r(n.result)},error:function(){console.log("Error loading latest bitcoin price ...")}})}function r(n){$("#event-store").trigger({type:"data-update-bitcoinPrice",serviceData:n})}function u(n){t!==null&&clearInterval(t);t=setInterval(function(){i()},n)}function f(){t!==null&&clearInterval(t)}var t=null;i();u(n)}n(3e5)})